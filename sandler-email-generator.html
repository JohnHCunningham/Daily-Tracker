<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandler Email Generator | AI Advantage Solutions</title>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* Brand Colors */
        :root {
            --brand-navy: #0C1030;
            --brand-teal: #10C3B0;
            --brand-aqua: #3DE0D2;
            --brand-pink: #E64563;
            --brand-gold: #F4B03A;
            --brand-yellow: #F9C863;
            --light-text: #F2F4F8;
            --card-bg: #131a40;
            --input-bg: #090c26;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, var(--brand-navy) 0%, #050816 100%);
            color: var(--light-text);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--brand-aqua), var(--brand-teal));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--brand-gold);
            font-size: 1.1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(61, 224, 210, 0.1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--brand-teal), var(--brand-aqua));
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            color: var(--brand-aqua);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--light-text);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            background-color: var(--input-bg);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--brand-teal);
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: var(--brand-aqua);
            box-shadow: 0 0 0 3px rgba(61, 224, 210, 0.1);
        }

        .input-group textarea {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .btn {
            background: linear-gradient(135deg, var(--brand-gold), var(--brand-yellow));
            border: none;
            padding: 12px 24px;
            color: var(--brand-navy);
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%;
            margin-top: 15px;
            font-size: 1rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(244, 176, 58, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-aqua));
        }

        .email-output {
            background: var(--input-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(61, 224, 210, 0.2);
            margin-bottom: 15px;
        }

        .email-subject {
            color: var(--brand-gold);
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .email-body {
            color: var(--light-text);
            line-height: 1.8;
            white-space: pre-wrap;
            font-size: 0.95rem;
        }

        .copy-btn {
            padding: 8px 16px;
            font-size: 0.9rem;
            width: auto;
            margin-top: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--brand-gold);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--light-text);
            opacity: 0.7;
            margin-top: 5px;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .alert-success {
            background: rgba(16, 195, 176, 0.2);
            border: 1px solid var(--brand-teal);
            color: var(--brand-aqua);
        }

        .alert-error {
            background: rgba(230, 69, 99, 0.2);
            border: 1px solid var(--brand-pink);
            color: var(--brand-pink);
        }

        .variations-container {
            display: grid;
            gap: 15px;
        }

        .variation {
            background: rgba(16, 195, 176, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--brand-teal);
        }

        .variation-label {
            color: var(--brand-teal);
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--brand-teal);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--light-text);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-aqua));
            color: var(--brand-navy);
            border-color: transparent;
        }

        .tab:hover:not(.active) {
            background: rgba(255,255,255,0.1);
        }

        .back-btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--brand-teal), var(--brand-aqua));
            color: var(--brand-navy);
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 700;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            z-index: 10;
            pointer-events: auto;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 195, 176, 0.4);
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>üéØ Sandler Email Generator</h1>
            <p>AI-Powered Prospecting Emails with A/B Testing</p>
            <div style="margin-top: 15px;">
                <a href="index.html" class="back-btn">
                    ‚Üê Back to Dashboard
                </a>
            </div>
        </div>

        <div id="alert-container"></div>

        <div class="grid">
            <!-- Input Form -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Prospect Details</h2>
                    <span>üìù</span>
                </div>

                <!-- ICP Context Display -->
                <div id="icp-context" style="display: none; margin-bottom: 20px; padding: 15px; background: rgba(61, 224, 210, 0.1); border-radius: 10px; border-left: 4px solid var(--brand-teal);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong style="color: var(--brand-teal); font-size: 0.9rem;">üéØ Using Your ICP Profile</strong>
                        <a href="index.html#icp" style="color: var(--brand-gold); font-size: 0.85rem; text-decoration: none;">Edit ICP ‚Üí</a>
                    </div>
                    <div id="icp-summary" style="font-size: 0.85rem; line-height: 1.6; opacity: 0.9;"></div>
                </div>

                <div class="input-group">
                    <label>First Name *</label>
                    <input type="text" id="first-name" placeholder="Sarah">
                </div>

                <div class="input-group">
                    <label>Company *</label>
                    <input type="text" id="company" placeholder="ABC Housing Corp">
                </div>

                <div class="input-group">
                    <label>Ideal Customer Profile (ICP) *</label>
                    <select id="icp-selector" onchange="updateICPContext()">
                        <option value="">Select ICP...</option>
                        <option value="saas-sales-leader">SaaS Sales Leader (5+ reps, using Sandler/MEDDIC)</option>
                        <option value="tech-vp-sales">Tech VP Sales (10-50 reps, struggling with execution)</option>
                        <option value="services-sales-manager">Professional Services Sales Manager (methodology trained team)</option>
                        <option value="smb-sales-owner">SMB Sales Owner (3-10 reps, need more pipeline)</option>
                        <option value="enterprise-cro">Enterprise CRO (50+ reps, scaling challenges)</option>
                        <option value="consulting-partner">Consulting Partner (selling to sales teams)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Industry</label>
                    <input type="text" id="industry" placeholder="e.g., B2B SaaS, Professional Services">
                </div>

                <div class="input-group" id="custom-pain-point-group">
                    <label>Additional Context (optional)</label>
                    <textarea id="pain-point" placeholder="Any specific challenges you know about..."></textarea>
                </div>

                <div class="input-group">
                    <label>Value Proposition</label>
                    <select id="value-prop">
                        <option value="execution">Execution (Help them convert better)</option>
                        <option value="attraction">Attraction (Help them get more leads)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Email Type</label>
                    <select id="email-type">
                        <option value="icebreaker">Ice Breaker (First contact)</option>
                        <option value="followup">Follow-up (After no response)</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Channel</label>
                    <select id="channel-type" onchange="updateChannelOptions()">
                        <option value="email">Email Outreach</option>
                        <option value="linkedin">LinkedIn Outreach</option>
                    </select>
                </div>

                <div id="email-options">
                    <div class="input-group">
                        <label>Email Approach</label>
                        <select id="email-style">
                            <option value="soft">Soft Approach (Consultative)</option>
                            <option value="bold">Bold Approach (Direct Challenge)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Call-to-Action</label>
                        <select id="cta-type">
                            <option value="calendar">Calendar Link</option>
                            <option value="reply">Reply "Curious"</option>
                            <option value="both">Both Options</option>
                        </select>
                    </div>
                </div>

                <div id="linkedin-options" style="display: none;">
                    <div class="input-group">
                        <label>LinkedIn Content Type</label>
                        <select id="linkedin-type" onchange="updateFieldRequirements()">
                            <option value="value-post">Value Post (Share insights)</option>
                            <option value="connection">Connection Request</option>
                            <option value="dm">Direct Message (After Connected)</option>
                            <option value="comment">Comment on Discussion</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Context (Optional)</label>
                        <textarea id="linkedin-context" placeholder="e.g., Saw your post about sales challenges..."></textarea>
                    </div>
                </div>

                <button class="btn" id="generate-btn" onclick="generateEmails()">‚ú® Generate Content</button>
                <button class="btn btn-secondary" onclick="generateVariations()">ü§ñ Generate AI Variations</button>
            </div>

            <!-- Email Output -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Generated Emails</h2>
                    <span>üìß</span>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="switchTab('subject')">Subject Lines</div>
                    <div class="tab" onclick="switchTab('email')">Email Body</div>
                    <div class="tab" onclick="switchTab('variations')">AI Variations</div>
                </div>

                <div id="output-container">
                    <p style="opacity: 0.7; text-align: center; padding: 40px;">Fill out the form and click "Generate Emails" to get started!</p>
                </div>
            </div>
        </div>

        <!-- A/B Testing Stats -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üìä Email Performance Tracking</h2>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="total-sent">0</div>
                    <div class="stat-label">Emails Sent</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="response-rate">0%</div>
                    <div class="stat-label">Response Rate</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="best-subject">‚Äî</div>
                    <div class="stat-label">Best Subject Line</div>
                </div>
            </div>

            <div id="tracking-details"></div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://qwqlsbccwnwrdpcaccjz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3cWxzYmNjd253cmRwY2FjY2p6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzMTA1MDQsImV4cCI6MjA4MDg4NjUwNH0.yWzSV2Nid_T1XiDE0RrskFob9mRUc-m6MbeIiT7huC4';

        let supabaseClient;
        let currentTab = 'subject';
        let generatedEmails = {};
        let currentVariations = [];

        // ICP-specific pain points and solutions database
        const ICPDatabase = {
            'saas-sales-leader': {
                industry: 'B2B SaaS',
                attractionPains: ['Pipeline inconsistent month-to-month', 'Cold calling yields 2-3% response rates', 'Marketing leads often unqualified', 'Reps spend 60% of day prospecting'],
                executionPains: ['Reps know Sandler/MEDDIC but don\'t use it consistently', 'Training ROI drops off after 2-3 weeks', 'Can only coach 2-3 calls per rep per week', 'Discovery calls missing key qualification questions'],
                attractionSolution: 'AI identifies ideal prospects and generates personalized outreach that gets 15-20% response rates',
                executionSolution: 'AI analyzes every call and gives reps specific Sandler/MEDDIC scripts to use next time',
                companySize: '5-20 sales reps',
                dealSize: '$10K-$100K ACV'
            },
            'tech-vp-sales': {
                industry: 'Technology/Software',
                attractionPains: ['Team can\'t scale outbound without hiring more SDRs', 'Speed to lead >5 minutes causes lost opportunities', 'Inconsistent pipeline across reps', 'High cost per lead'],
                executionPains: ['Methodology execution drops to 30% by week 4', 'Can\'t measure ROI on $50K+ training investment', 'Manager overwhelm - can\'t coach 20+ reps individually', 'Deals stalling in discovery due to poor qualification'],
                attractionSolution: 'AI-powered prospecting generates 3x more qualified meetings without adding headcount',
                executionSolution: 'AI coaches every call with methodology-specific scripts, ensuring consistent execution',
                companySize: '10-50 sales reps',
                dealSize: '$25K-$250K ACV'
            },
            'services-sales-manager': {
                industry: 'Professional Services',
                attractionPains: ['Too reliant on referrals and word-of-mouth', 'Outbound efforts feel scattershot', 'Hard to identify ideal prospects', 'Low meeting-to-proposal ratio'],
                executionPains: ['Consultative selling skills inconsistent across team', 'Reps skip discovery questions under time pressure', 'Value prop conversations don\'t differentiate', 'Proposals sent without proper qualification'],
                attractionSolution: 'AI identifies high-fit prospects and creates personalized outreach based on their specific needs',
                executionSolution: 'AI ensures reps ask critical discovery questions and build value before proposing',
                companySize: '5-15 consultants',
                dealSize: '$50K-$500K project value'
            },
            'smb-sales-owner': {
                industry: 'SMB / Small Business',
                attractionPains: ['Pipeline too thin to hit quota consistently', 'Can\'t afford dedicated SDR team', 'Manual prospecting takes too much time', 'Limited marketing budget for lead gen'],
                executionPains: ['No formal sales process or methodology', 'Reps wing it on calls', 'Inconsistent qualification leads to bad deals', 'Coaching happens ad-hoc, not systematically'],
                attractionSolution: 'AI automates prospecting and generates personalized outreach, filling pipeline without hiring',
                executionSolution: 'AI provides real-time coaching scripts so every rep sells like your best rep',
                companySize: '3-10 sales reps',
                dealSize: '$5K-$50K deals'
            },
            'enterprise-cro': {
                industry: 'Enterprise',
                attractionPains: ['ABM campaigns not generating enough pipeline', 'Long sales cycles need constant pipeline injection', 'SDR team expensive but ROI unclear', 'Can\'t personalize at scale'],
                executionPains: ['Inconsistent execution across global teams', 'Complex sales methodology (MEDDIC, Challenger) hard to scale', 'Coaching doesn\'t reach all reps', 'Revenue forecasting unreliable due to poor qualification'],
                attractionSolution: 'AI-powered ABM outreach generates executive-level meetings at scale',
                executionSolution: 'AI ensures methodology compliance across global teams with real-time coaching',
                companySize: '50-200+ sales reps',
                dealSize: '$100K-$1M+ deals'
            },
            'consulting-partner': {
                industry: 'Sales Consulting / Training',
                attractionPains: ['Hard to prove ROI to prospective clients', 'Competing with in-house enablement teams', 'Difficult to generate qualified leads', 'Long sales cycles for consulting engagements'],
                executionPains: ['Clients don\'t stick with methodology after training ends', 'No way to measure behavior change', 'Consulting doesn\'t scale without more consultants', 'Hard to show tangible results'],
                attractionSolution: 'AI-powered platform you can white-label and offer to clients as part of your training programs',
                executionSolution: 'AI extends your training impact by coaching reps 24/7 long after you leave',
                companySize: 'Varies by client',
                dealSize: '$25K-$250K consulting engagements'
            }
        };

        // Update context when ICP is selected
        function updateICPContext() {
            const icpSelector = document.getElementById('icp-selector');
            const selectedICP = icpSelector.value;
            const industryField = document.getElementById('industry');

            if (selectedICP && ICPDatabase[selectedICP]) {
                const icpData = ICPDatabase[selectedICP];
                // Auto-fill industry
                if (industryField && !industryField.value) {
                    industryField.value = icpData.industry;
                }
            }
        }

        // Initialize
        window.onload = function() {
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            loadEmailStats();
            loadICPData(); // Auto-populate from ICP
        };

        // Load ICP data from localStorage and auto-populate form
        function loadICPData() {
            const savedICP = localStorage.getItem('icp');
            if (savedICP) {
                try {
                    const icp = JSON.parse(savedICP);

                    // Auto-populate industry field
                    if (icp.industry) {
                        document.getElementById('industry').value = icp.industry;
                    }

                    // Auto-populate pain point field
                    if (icp.painPoints) {
                        document.getElementById('pain-point').value = icp.painPoints;
                    }

                    // Display ICP summary panel
                    const icpContext = document.getElementById('icp-context');
                    const icpSummary = document.getElementById('icp-summary');

                    if (icpContext && icpSummary) {
                        let summaryHTML = '';
                        if (icp.industry) summaryHTML += `<strong>Target:</strong> ${icp.industry}<br>`;
                        if (icp.companySize) summaryHTML += `<strong>Size:</strong> ${icp.companySize}<br>`;
                        if (icp.jobTitles) summaryHTML += `<strong>Titles:</strong> ${icp.jobTitles}<br>`;
                        if (icp.characteristics) {
                            const shortCharacteristics = icp.characteristics.substring(0, 150) + (icp.characteristics.length > 150 ? '...' : '');
                            summaryHTML += `<strong>Key Characteristics:</strong> ${shortCharacteristics}`;
                        }

                        if (summaryHTML) {
                            icpSummary.innerHTML = summaryHTML;
                            icpContext.style.display = 'block';
                        }
                    }

                    // Show success message
                    if (icp.industry || icp.painPoints) {
                        showAlert('‚úÖ ICP data loaded! Industry and Pain Points auto-filled from your profile.', 'success');
                    }
                } catch (error) {
                    console.error('Error loading ICP data:', error);
                }
            }
        }

        // Show alert
        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        // Update channel options
        function updateChannelOptions() {
            const channel = document.getElementById('channel-type').value;
            const generateBtn = document.getElementById('generate-btn');
            const linkedinType = document.getElementById('linkedin-type').value;

            if (channel === 'linkedin') {
                document.getElementById('email-options').style.display = 'none';
                document.getElementById('linkedin-options').style.display = 'block';

                // Update button text
                generateBtn.innerHTML = 'üíº Generate LinkedIn Post';

                // Update field requirements based on LinkedIn type
                updateFieldRequirements();
            } else {
                document.getElementById('email-options').style.display = 'block';
                document.getElementById('linkedin-options').style.display = 'none';

                // Update button text
                generateBtn.innerHTML = 'üìß Generate Email';

                // Restore email field requirements
                updateFieldRequirements();
            }
        }

        // Update field requirements based on content type
        function updateFieldRequirements() {
            const channel = document.getElementById('channel-type').value;
            const linkedinType = document.getElementById('linkedin-type').value;
            const firstNameLabel = document.querySelector('label[for="first-name"]');
            const companyLabel = document.querySelector('label[for="company"]');

            if (channel === 'linkedin' && linkedinType === 'value-post') {
                // Value posts don't need name/company
                if (firstNameLabel) firstNameLabel.innerHTML = 'First Name <span style="opacity: 0.5;">(optional for value posts)</span>';
                if (companyLabel) companyLabel.innerHTML = 'Company <span style="opacity: 0.5;">(optional for value posts)</span>';
            } else {
                // Restore required indicators
                if (firstNameLabel) firstNameLabel.innerHTML = 'First Name *';
                if (companyLabel) companyLabel.innerHTML = 'Company *';
            }
        }

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            displayCurrentTab();
        }

        // Generate emails from templates
        function generateEmails() {
            const firstName = document.getElementById('first-name').value.trim();
            const company = document.getElementById('company').value.trim();
            const industry = document.getElementById('industry').value.trim() || 'your industry';
            const painPoint = document.getElementById('pain-point').value.trim();
            const channel = document.getElementById('channel-type').value;
            const valueProp = document.getElementById('value-prop').value;
            const linkedinType = document.getElementById('linkedin-type').value;

            // Check required fields (name/company not needed for LinkedIn value posts)
            const isValuePost = channel === 'linkedin' && linkedinType === 'value-post';
            if (!isValuePost && (!firstName || !company)) {
                showAlert('Please enter at least First Name and Company', 'error');
                return;
            }

            if (channel === 'linkedin') {
                generateLinkedInMessages(firstName, company, industry, painPoint);
            } else {
                const style = document.getElementById('email-style').value;
                const ctaType = document.getElementById('cta-type').value;

                // Generate subject lines based on value proposition
                let subjectLines;
                if (valueProp === 'attraction') {
                    subjectLines = [
                        `${firstName} - Are you getting enough qualified leads?`,
                        `Quick question about ${company}'s prospecting results`,
                        `${company} - Get 3x more meetings without cold calling`
                    ];
                } else {
                    subjectLines = [
                        `${firstName} - Are your reps executing Sandler or just talking about it?`,
                        `Quick question about ${company}'s Sandler execution`,
                        `${company} - Sandler coaching that doesn't require a $10K consultant`
                    ];
                }

                // Generate email body based on value proposition
                let emailBody;
                if (valueProp === 'attraction') {
                    emailBody = style === 'soft' ? generateAttractionSoftEmail(firstName, company, industry, painPoint, ctaType) : generateAttractionBoldEmail(firstName, company, industry, painPoint, ctaType);
                } else {
                    emailBody = style === 'soft' ? generateSoftEmail(firstName, company, industry, painPoint, ctaType) : generateBoldEmail(firstName, company, industry, painPoint, ctaType);
                }

                generatedEmails = {
                    subjectLines,
                    emailBody,
                    style,
                    firstName,
                    company,
                    valueProp,
                    channel: 'email'
                };

                currentTab = 'subject';
                displayCurrentTab();
                showAlert('‚úÖ Emails generated! Click tabs to see subject lines, body, and request AI variations.', 'success');
            }
        }

        // Generate LinkedIn messages
        function generateLinkedInMessages(firstName, company, industry, painPoint) {
            const linkedinType = document.getElementById('linkedin-type').value;
            const context = document.getElementById('linkedin-context').value.trim();
            const valueProp = document.getElementById('value-prop').value;

            let messages = {};

            switch(linkedinType) {
                case 'value-post':
                    const postTitle = valueProp === 'attraction' ? 'LinkedIn Value Post (Attraction)' : 'LinkedIn Value Post (Execution)';
                    messages = {
                        subjectLines: [postTitle],
                        emailBody: valueProp === 'attraction'
                            ? generateLinkedInAttractionPost()
                            : generateLinkedInExecutionPost()
                    };
                    break;
                case 'connection':
                    messages = {
                        subjectLines: ['LinkedIn Connection Request'],
                        emailBody: generateLinkedInConnection(firstName, company, context, valueProp)
                    };
                    break;
                case 'dm':
                    messages = {
                        subjectLines: ['LinkedIn Direct Message'],
                        emailBody: generateLinkedInDM(firstName, company, industry, painPoint, context, valueProp)
                    };
                    break;
                case 'comment':
                    messages = {
                        subjectLines: ['Discussion Comment'],
                        emailBody: generateLinkedInComment(context, valueProp)
                    };
                    break;
            }

            generatedEmails = {
                ...messages,
                style: linkedinType,
                firstName,
                company,
                valueProp,
                channel: 'linkedin'
            };

            currentTab = 'email';
            displayCurrentTab();
            showAlert('‚úÖ LinkedIn content generated!', 'success');
        }

        // Generate LinkedIn Execution Value Post
        function generateLinkedInExecutionPost() {
            const icpSelector = document.getElementById('icp-selector').value;
            const icpData = ICPDatabase[icpSelector] || {};

            // Get ICP-specific pain points
            const pains = icpData.executionPains || [
                'Reps know the methodology but don\'t execute it consistently',
                'Training ROI drops off after 2-3 weeks',
                'Can only coach 2-3 calls per rep per week'
            ];

            // Create attention-grabbing headline with pure value
            const topPain = pains[0].toLowerCase();

            return `I tracked methodology execution for 200+ sales teams.

Here's what I found:

Week 1 after training: 85% execution
Week 2: 64% execution
Week 4: 31% execution
Week 12: Back to winging it

Your $50K training investment? Gone by month 2.

The real issue isn't the training quality. It's this: ${topPain}

Here's what the top 10% do differently:

They don't rely on memory. They build reinforcement systems.

Example from a VP I worked with:
- Sends daily 2-min "situation of the day" texts
- Reps practice the exact objection they'll hear today
- Reviews one call per rep per day (not weekly)
- Celebrates when reps execute, not just when they close

His team? Still at 72% execution 90 days later.

The pattern I see: Reinforcement beats training. Frequency beats intensity.

Most teams train hard then hope. Top teams train, then reinforce daily.

Question for the group: What's ONE thing you do to keep methodology fresh after training?

Drop your best practice below üëá

---

P.S. - The most surprising finding? Teams that review calls DAILY (even 5 min) outperform teams that do weekly 1-hour reviews. Frequency > Duration.`;
        }

        // Generate LinkedIn Attraction Value Post
        function generateLinkedInAttractionPost() {
            const icpSelector = document.getElementById('icp-selector').value;
            const icpData = ICPDatabase[icpSelector] || {};

            // Get ICP-specific pain points
            const pains = icpData.attractionPains || [
                'Pipeline inconsistent month-to-month',
                'Cold calling yields 2-3% response rates',
                'Manual prospecting takes too much time'
            ];

            // Create attention-grabbing headline with pure value
            const topPain = pains[0].toLowerCase();

            return `I analyzed cold outreach from 89 B2B sales teams.

The data is brutal:

Average response rate: 2.7%
Average cost per meeting: $347
Average rep says "I need more leads" while sitting on 1,000+ prospects

The real problem isn't lead volume. It's this: ${topPain}

Here's what I learned from the top performers (15-20% response rates):

They don't do MORE outreach. They do SMARTER outreach.

Real example from a sales leader I work with:

Before:
"Hi [Name], I'd love to schedule 15 minutes to discuss how we can help [Company]..."
Response rate: 3%

After:
"[Name] - saw [Company] just [specific trigger event]. Most [industry] companies struggle with [exact pain point] when this happens. Talked to [similar company] who faced this. Worth a quick conversation?"
Response rate: 18%

Same rep. Same offer. 6x better results.

The framework: Trigger ‚Üí Pain ‚Üí Proof ‚Üí Question

Most reps skip straight to "can we talk?" Top reps earn the conversation first.

The pattern I see: Context beats cold. Relevance beats reach.

Your pipeline isn't empty because you need more leads. It's empty because you're not giving prospects a reason to respond.

Question: What's your current cold outreach response rate? (Be honest üëá)

---

P.S. - The best trigger I've seen? When a company posts a job opening. Their problem is literally public. Use it.`;
        }

        // Generate LinkedIn connection request
        function generateLinkedInConnection(firstName, company, context, valueProp) {
            if (context) {
                const focusArea = valueProp === 'attraction'
                    ? 'helping sales teams generate more qualified leads'
                    : 'helping sales teams execute their methodology';
                return `Hi ${firstName},\n\n${context}\n\nI work with sales teams on ${focusArea}. Would love to connect and share insights!\n\nBest,\nJohn`;
            } else {
                const focusArea = valueProp === 'attraction'
                    ? 'helping sales teams fill the pipeline with qualified leads'
                    : 'implementing sales methodology execution';
                return `Hi ${firstName},\n\nSaw you're with ${company}. I work with sales teams on ${focusArea} and would love to connect.\n\nLooking forward to sharing insights!\n\nBest,\nJohn`;
            }
        }

        // Generate LinkedIn DM (after connection)
        function generateLinkedInDM(firstName, company, industry, painPoint, context, valueProp) {
            const contextLine = context ? `\n\n${context}\n\n` : '\n\n';

            if (valueProp === 'attraction') {
                return `Hi ${firstName},${contextLine}Thanks for connecting! I noticed you're focused on ${industry}.

Quick question: Is your pipeline full enough to hit quota comfortably?

Most sales leaders tell me the same thing:
- Cold calling takes too much time with minimal return
- Marketing leads are inconsistent
- Pipeline is always too thin

We built an AI system that identifies ideal prospects and generates personalized outreach that gets 15-20% response rates (vs. 2-3% industry average).

Result: 3x more qualified meetings per month without burning out your reps.

Worth a quick look? I can send you a 2-min demo or we could jump on a quick call.

Either way, happy to be connected!

Best,
John`;
            }

            return `Hi ${firstName},${contextLine}Thanks for connecting! I noticed you're focused on ${industry}.

Quick question: After your team gets Sandler training, do you have a system to ensure they're actually EXECUTING it in real calls?

Most sales leaders I talk to face the same challenge:
- Reps learn Sandler ‚Üí Get excited ‚Üí Week 1-2 they use it ‚Üí Week 4+ back to old habits

I built an AI coaching tool that analyzes every call and gives reps specific Sandler scripts to use next time.

Example: When prospect says "We're too busy," instead of ending the call, it coaches:
"Try: I get it. That's exactly why I called‚Äîto give you back 20 hours/week. Worth 15 min to explore?"

Worth a quick look? I can send you a 2-min demo or we could jump on a quick call.

Either way, happy to be connected!

Best,
John`;
        }

        // Generate LinkedIn comment
        function generateLinkedInComment(context, valueProp) {
            if (valueProp === 'attraction') {
                if (!context) {
                    return `Great point! Most teams struggle to fill the pipeline. We built an AI system that generates personalized outreach and gets 15-20% response rates. 3x more qualified meetings without the manual grind.`;
                }
                return `Totally agree with this.\n\n${context}\n\nWe solved this with AI-powered prospecting. Identifies ideal prospects and creates personalized outreach automatically. Reps spend less time prospecting, more time selling.\n\nHappy to share more if useful!`;
            }

            if (!context) {
                return `Great point! The gap between Sandler training and execution is massive. We built an AI tool that gives reps specific scripts after every call. Game-changer for reinforcement.`;
            }

            return `Totally agree with this.\n\n${context}\n\nWe solved this with an AI coach that analyzes calls and gives Sandler-specific scripts. Reps get feedback on EVERY call, not just the ones managers review.\n\nHappy to share more if useful!`;
        }

        // Generate soft approach email
        function generateSoftEmail(firstName, company, industry, painPoint, ctaType) {
            const ctaText = getCTAText(ctaType);
            const emailType = document.getElementById('email-type').value;
            const icpSelector = document.getElementById('icp-selector').value;
            const icpData = ICPDatabase[icpSelector] || {};

            // Get ICP-specific pain points
            const pains = icpData.executionPains || [
                'Reps know the methodology but don\'t use it consistently',
                'Training ROI drops off after 2-3 weeks',
                'Can only coach 2-3 calls per rep per week'
            ];
            const solution = icpData.executionSolution || 'AI analyzes every call and gives reps methodology-specific scripts';

            if (emailType === 'followup') {
                return `Hi ${firstName},

Not sure if you saw my note below about sales methodology execution.

Quick question: Do you have a system to coach every call your team makes, or just 2-3 per week per rep?

Most managers can't scale coaching. We built an AI that gives reps specific scripts after EVERY call.

Worth 15 minutes to explore?

${ctaText}

Best,
John Cunningham
AI Advantage Solutions`;
            }

            // Ice breaker version with ICP-specific pains
            const painsList = pains.slice(0, 3).map(p => `- ${p}`).join('\n');

            return `Hi ${firstName},

Quick question: Are your reps executing their sales methodology in real conversations, or just talking about it?

Most sales leaders in ${industry || 'your space'} tell me:
${painsList}

Sound familiar?

We built an AI coach that solves this: ${solution}

Example: When prospect says "We're too busy," the AI coaches:
"Try: That's why I called‚Äîto give you back 20 hours/week. Worth 15 min?"

Result: Reps actually execute what they learned in training.

Worth 15 minutes to see if this works for ${company}?

${ctaText}

Best,
John Cunningham
AI Advantage Solutions`;
        }

        // Generate bold approach email
        function generateBoldEmail(firstName, company, industry, painPoint, ctaType) {
            const ctaText = getCTAText(ctaType);
            const emailType = document.getElementById('email-type').value;
            const icpSelector = document.getElementById('icp-selector').value;
            const icpData = ICPDatabase[icpSelector] || {};

            // Get ICP-specific data
            const topPain = icpData.executionPains ? icpData.executionPains[0] : 'Methodology execution drops to 30% by week 4';
            const solution = icpData.executionSolution || 'AI analyzes every call and gives reps methodology-specific scripts';

            if (emailType === 'followup') {
                return `${firstName} -

Haven't heard back, so I'll be direct:

Your sales methodology investment is probably being wasted.

Week 1: Reps execute. Week 4: 30% compliance. Week 12: Back to old habits.

We've helped teams in ${industry || 'your space'} fix this with AI coaching after EVERY call. Reps get specific scripts, not generic feedback.

Worth a quick call to stop the ROI leak?

${ctaText}

John Cunningham
AI Advantage Solutions`;
            }

            // Ice breaker version - direct and bold with ICP pain
            return `Hi ${firstName},

Your methodology-trained reps aren't executing what they learned.

I know that's direct, but here's what I see constantly in ${industry || 'your space'}:
- Week 1: Fired up
- Week 4: Using 30% of it
- Week 12: Back to old habits

The $50K+ training investment? Wasted.

The real problem: ${topPain}

We built an AI that solves this. ${solution}

Example: Prospect says "Send info." AI coaches:
"Try: Happy to. After you review it, what happens next?"

Result: 40%+ improvement in methodology execution scores.

Worth 15 minutes to see if this stops the ROI leak at ${company}?

${ctaText}

Best,
John Cunningham
AI Advantage Solutions`;
        }

        // Generate attraction soft approach email
        function generateAttractionSoftEmail(firstName, company, industry, painPoint, ctaType) {
            const ctaText = getCTAText(ctaType);
            const emailType = document.getElementById('email-type').value;
            const icpSelector = document.getElementById('icp-selector').value;
            const icpData = ICPDatabase[icpSelector] || {};

            // Get ICP-specific pain points
            const pains = icpData.attractionPains || [
                'Pipeline inconsistent month-to-month',
                'Cold calling yields 2-3% response rates',
                'Manual prospecting takes too much time'
            ];
            const solution = icpData.attractionSolution || 'AI identifies ideal prospects and generates personalized outreach that gets 15-20% response rates';

            if (emailType === 'followup') {
                return `Hi ${firstName},

Not sure if you saw my note below about helping ${company} get more qualified leads.

Quick question: Is your pipeline full enough to hit quota comfortably?

Most teams struggle with this. We've helped companies in ${industry || 'your space'} 3x their qualified meetings using AI-powered prospecting.

Worth 15 minutes to explore?

${ctaText}

Best,
John Cunningham
AI Advantage Solutions`;
            }

            // Ice breaker version with ICP-specific pains
            const painsList = pains.slice(0, 3).map(p => `- ${p}`).join('\n');

            return `Hi ${firstName},

Quick question: Is ${company}'s pipeline full enough to hit quota comfortably?

Most sales leaders in ${industry || 'your space'} tell me:
${painsList}

Sound familiar?

We built an AI system that solves this: ${solution}

Result: 3x more qualified meetings per month without burning out your reps.

Worth 15 minutes to see if this could work for ${company}?

${ctaText}

Best,
John Cunningham
AI Advantage Solutions`;
        }

        // Generate attraction bold approach email
        function generateAttractionBoldEmail(firstName, company, industry, painPoint, ctaType) {
            const ctaText = getCTAText(ctaType);
            const emailType = document.getElementById('email-type').value;
            const icpSelector = document.getElementById('icp-selector').value;
            const icpData = ICPDatabase[icpSelector] || {};

            // Get ICP-specific data
            const topPain = icpData.attractionPains ? icpData.attractionPains[0] : 'Pipeline too thin to hit quota consistently';
            const solution = icpData.attractionSolution || 'AI-powered prospecting generates 3x more qualified meetings';
            const pains = icpData.attractionPains || ['Cold calling = low ROI', 'Marketing leads = inconsistent', 'Manual prospecting = too time-consuming'];

            if (emailType === 'followup') {
                return `${firstName} -

Haven't heard back, so I'll be direct:

Is your pipeline full enough, or could you use more qualified meetings?

If it's the latter, we've helped teams in ${industry || 'your space'} 3x their qualified meetings using AI-powered prospecting.

15-20% response rates vs. 2-3% industry average.

Worth a quick call?

${ctaText}

John Cunningham
AI Advantage Solutions`;
            }

            // Ice breaker version - direct with ICP pains
            const painsList = pains.slice(0, 3).map(p => `- ${p}`).join('\n');

            return `Hi ${firstName},

I'll be direct: ${topPain}

The usual suspects aren't working for teams in ${industry || 'your space'}:
${painsList}

We built an AI system that solves this. ${solution}

Results: 15-20% response rates. 3x more qualified meetings. No SDR burnout.

Worth 15 minutes to see if this works for ${company}?

${ctaText}

Best,
John Cunningham
AI Advantage Solutions`;
        }

        // Get CTA text based on type
        function getCTAText(ctaType) {
            if (ctaType === 'calendar') {
                return 'If yes, book an Execution Exploration call (20 min, no pitch):\nhttps://tidycal.com/aiautomations/execution-exploration';
            } else if (ctaType === 'reply') {
                return 'If yes, just reply "interested" and I\'ll send you more details.\nIf no, reply "not a fit" and I won\'t follow up.';
            } else {
                return 'If yes, book an Execution Exploration call:\nhttps://tidycal.com/aiautomations/execution-exploration\n\nOr just reply "interested" for more details first.\nIf not a fit, just say so and I won\'t follow up.';
            }
        }

        // Display current tab content
        function displayCurrentTab() {
            const output = document.getElementById('output-container');

            if (!generatedEmails.subjectLines) {
                return;
            }

            if (currentTab === 'subject') {
                output.innerHTML = `
                    <div class="variations-container">
                        ${generatedEmails.subjectLines.map((subject, i) => `
                            <div class="variation">
                                <div class="variation-label">Subject Line ${i + 1}</div>
                                <div style="color: var(--brand-gold); font-weight: 600; margin-bottom: 10px;">${subject}</div>
                                <button class="btn copy-btn" onclick="copyText('${subject.replace(/'/g, "\\'")}', 'Subject line copied!')">üìã Copy</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (currentTab === 'email') {
                output.innerHTML = `
                    <div class="email-output">
                        <div class="email-subject">Subject: ${generatedEmails.subjectLines[0]}</div>
                        <div class="email-body">${generatedEmails.emailBody}</div>
                        <button class="btn copy-btn" onclick="copyEmailToClipboard()">üìã Copy Full Email</button>
                        <button class="btn copy-btn btn-secondary" onclick="trackEmailSent()">‚úÖ Mark as Sent</button>
                    </div>
                `;
            } else if (currentTab === 'variations') {
                output.innerHTML = `
                    <div id="variations-output">
                        <p style="opacity: 0.7; text-align: center; padding: 20px;">Click "Generate AI Variations" to get Claude-powered email alternatives!</p>
                    </div>
                `;
            }
        }

        // Generate smart variations using different Sandler strategies
        function generateVariations() {
            if (!generatedEmails.emailBody) {
                showAlert('Please generate base emails first!', 'error');
                return;
            }

            showAlert('‚ú® Generating strategic variations...', 'success');
            currentTab = 'variations';

            // Update tab UI
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab')[2].classList.add('active');

            // First display the variations tab to create the container
            displayCurrentTab();

            // Now get the variations output element
            const variationsOutput = document.getElementById('variations-output');
            if (!variationsOutput) {
                console.error('Could not find variations-output element');
                return;
            }

            const loadingText = generatedEmails.valueProp === 'attraction'
                ? 'Creating Attraction-based variations...'
                : 'Creating Sandler-based variations...';
            variationsOutput.innerHTML = `<div class="loading">${loadingText}</div>`;

            // Create intelligent variations based on value proposition
            if (generatedEmails.valueProp === 'attraction') {
                currentVariations = generateAttractionVariations();
            } else {
                currentVariations = generateExecutionVariations();
            }

            // Render variations with safer onclick handlers
            let html = '<div class="variations-container">';
            currentVariations.forEach((v, i) => {
                html += `
                    <div class="variation">
                        <div class="variation-label">${v.title}</div>
                        <div class="email-body" style="margin-top: 10px; white-space: pre-wrap;">${v.email}</div>
                        <button class="btn copy-btn" onclick="copyVariation(${i})">üìã Copy This Version</button>
                    </div>
                `;
            });
            html += '</div>';

            variationsOutput.innerHTML = html;
            showAlert('‚úÖ 4 strategic variations generated!', 'success');
        }

        // Generate Execution-focused variations (original Sandler-based)
        function generateExecutionVariations() {
            return [
                {
                    title: "Variation 1: Negative Reverse Selling",
                    email: `Hi ${generatedEmails.firstName},

I'm not sure if this is relevant to ${generatedEmails.company}, but I'll take 30 seconds.

Most sales leaders tell me their reps learned Sandler... but don't actually USE it in real conversations.

Sound familiar?

If it does, I built something that might help: An AI coach that gives your reps specific Sandler scripts after every call.

Example: When a prospect says "We're too busy," it coaches:
"Try: I get it. That's why I called‚Äîto give you back 20 hours/week. Worth 15 min?"

If this isn't a fit, no worries. But if it is, would 15 minutes make sense to explore?

Worst case, you'll tell me "not a fit" and we'll both move on.

Fair enough?

Best,
John Cunningham
AI Advantage Solutions
[Calendar Link]`
                },
                {
                    title: "Variation 2: Pain Funnel Focus",
                    email: `Hi ${generatedEmails.firstName},

Quick question about ${generatedEmails.company}:

After your team gets Sandler training, how long does it take before they're back to old habits?

Here's what I typically hear:
- Week 1-2: They use the Pain Funnel
- Week 4: Using maybe 30% of it
- Week 8: Back to feature-dumping

The problem? No real-time reinforcement.

I built an AI system that analyzes EVERY call and coaches reps with specific Sandler scripts.

Here's my question: If I could show you a way to make Sandler stick for 90+ days instead of 14 days, would 15 minutes be a good investment?

If yes: [Calendar Link]
If no: Just tell me "not interested" and I'll stop here.

Best,
John Cunningham
AI Advantage Solutions
Hamilton, ON`
                },
                {
                    title: "Variation 3: Ultra-Brief (Mobile Optimized)",
                    email: `${generatedEmails.firstName} -

Problem: Your reps learned Sandler but don't execute it.

Solution: AI coach gives them specific scripts after EVERY call.

Example:
Prospect: "We're too busy"
AI: "Try: That's why I called‚Äîto give you 20 hours back. 15 min?"

Worth a 15-min demo?

[Calendar Link]

John Cunningham
AI Advantage Solutions`
                },
                {
                    title: "Variation 4: Social Proof Version",
                    email: `Hi ${generatedEmails.firstName},

I work with Sandler-trained sales teams at companies like ${generatedEmails.company}.

Common challenge they share: Reps know the methodology but don't execute it consistently.

We solved this with an AI coaching system that:
- Analyzes 100% of calls (not just 2-3/week)
- Gives reps exact Sandler scripts for next time
- Reinforces Pain Funnel, Up-Front Contract, Budget discussion, etc.

Real example: When prospect says "Send me info," AI coaches:
"Try: Happy to. After you review it, what happens? Should we book 15 min to discuss, or will you reach out?"

Teams using this are seeing 40%+ improvement in Sandler execution scores.

Would it make sense to see if this could work for ${generatedEmails.company}?

15-minute demo: [Calendar Link]

Best,
John Cunningham
AI Advantage Solutions
Hamilton, ON`
                }
            ];
        }

        // Generate Attraction-focused variations
        function generateAttractionVariations() {
            return [
                {
                    title: "Variation 1: Problem-Agitate-Solve",
                    email: `Hi ${generatedEmails.firstName},

Quick question: Is ${generatedEmails.company}'s pipeline full enough to hit quota comfortably?

Most sales leaders I talk to say the same thing:
- Pipeline is too thin month after month
- Cold calling burns out reps with minimal ROI
- Marketing leads are inconsistent or unqualified

Sound familiar?

I built an AI-powered lead generation system that finds your ideal prospects and creates personalized outreach that actually gets responses.

Real results: Our clients average 15-20% response rates and book 3x more qualified meetings per month.

Example outreach it creates:
"Hi ${generatedEmails.firstName}, noticed ${generatedEmails.company} is expanding. Most teams in your space struggle with pipeline consistency. We've helped similar companies 3x their meetings. Worth a quick chat?"

Would 15 minutes make sense to see if this could help ${generatedEmails.company} fill the pipeline?

If yes: [Calendar Link]
If no: Just reply "not a fit" and I'll stop here.

Best,
John Cunningham
AI Advantage Solutions`
                },
                {
                    title: "Variation 2: Negative Reverse (Attraction)",
                    email: `${generatedEmails.firstName} -

I'm not sure if this is relevant to ${generatedEmails.company}, but I'll be quick.

Most sales teams struggle to fill the pipeline with qualified leads. Cold calling isn't working like it used to.

If that sounds familiar, I might be able to help.

I built an AI system that identifies your ideal prospects and generates personalized outreach (15-20% response rates vs. 2-3% industry average).

Example: Instead of generic cold emails, it creates:
"Saw you're at ${generatedEmails.company}. Teams in your space often struggle with pipeline consistency. We've helped similar companies 3x their qualified meetings. Worth exploring?"

If this could help you get more qualified meetings, would 15 minutes be worth it?

If not, no worries‚Äîjust let me know and I'll stop here.

Best,
John Cunningham
[Calendar Link]`
                },
                {
                    title: "Variation 3: Ultra-Brief (Mobile Optimized)",
                    email: `${generatedEmails.firstName} -

Problem: Not enough qualified leads in the pipeline.

Solution: AI finds your ideal prospects + generates personalized outreach that gets 15-20% response rates.

Result: 3x more qualified meetings per month.

Worth a 15-min demo?

[Calendar Link]

John Cunningham
AI Advantage Solutions`
                },
                {
                    title: "Variation 4: Social Proof + Stats",
                    email: `Hi ${generatedEmails.firstName},

I work with sales leaders at companies like ${generatedEmails.company} who need more qualified leads in the pipeline.

Common challenge: Cold calling takes too much time with too little return. Marketing leads are inconsistent.

Our solution: AI-powered lead generation that:
- Identifies your ideal prospects automatically
- Creates personalized outreach (not generic templates)
- Gets 15-20% response rates vs. 2-3% industry average

Real results:
- 3x more qualified meetings per month
- Reps spend less time prospecting, more time selling
- Pipeline stays full and predictable

Example outreach we generate:
"Hi ${generatedEmails.firstName}, saw ${generatedEmails.company} is growing. Most teams struggle with pipeline consistency. We've helped similar companies 3x meetings. Worth a chat?"

Would it make sense to explore if this could work for ${generatedEmails.company}?

15-minute demo: [Calendar Link]

Best,
John Cunningham
AI Advantage Solutions`
                }
            ];
        }

        // Copy a variation by index
        function copyVariation(index) {
            if (currentVariations[index]) {
                copyText(currentVariations[index].email, '‚úÖ Copied!');
            }
        }

        // Copy text to clipboard
        function copyText(text, message) {
            navigator.clipboard.writeText(text).then(() => {
                showAlert(message || '‚úÖ Copied!', 'success');
            });
        }

        // Copy full email to clipboard
        function copyEmailToClipboard() {
            const fullEmail = `Subject: ${generatedEmails.subjectLines[0]}\n\n${generatedEmails.emailBody}`;
            copyText(fullEmail, '‚úÖ Copied!');
        }

        // Track email as sent
        async function trackEmailSent() {
            if (!generatedEmails.company) return;

            try {
                await supabaseClient.from('Email_Tracking').insert({
                    prospect_name: generatedEmails.firstName,
                    prospect_company: generatedEmails.company,
                    subject_line: generatedEmails.subjectLines[0],
                    email_style: generatedEmails.style,
                    sent_date: new Date().toISOString().split('T')[0],
                    status: 'sent'
                });

                showAlert('‚úÖ Email marked as sent and tracked!', 'success');
                loadEmailStats();
            } catch (error) {
                console.error('Tracking error:', error);
                showAlert('‚ö†Ô∏è Email not tracked (table may not exist yet)', 'error');
            }
        }

        // Load email statistics
        async function loadEmailStats() {
            try {
                const { data, error } = await supabaseClient
                    .from('Email_Tracking')
                    .select('*')
                    .order('sent_date', { ascending: false });

                if (error) throw error;

                const totalSent = data.length;
                const responded = data.filter(e => e.status === 'responded' || e.status === 'booked').length;
                const responseRate = totalSent > 0 ? ((responded / totalSent) * 100).toFixed(1) : 0;

                // Find best subject line
                const subjectStats = {};
                data.forEach(email => {
                    if (!subjectStats[email.subject_line]) {
                        subjectStats[email.subject_line] = { sent: 0, responded: 0 };
                    }
                    subjectStats[email.subject_line].sent++;
                    if (email.status === 'responded' || email.status === 'booked') {
                        subjectStats[email.subject_line].responded++;
                    }
                });

                let bestSubject = '‚Äî';
                let bestRate = 0;
                Object.entries(subjectStats).forEach(([subject, stats]) => {
                    const rate = stats.responded / stats.sent;
                    if (rate > bestRate && stats.sent >= 2) { // Only count if sent at least 2 times
                        bestRate = rate;
                        bestSubject = subject.substring(0, 30) + '...';
                    }
                });

                document.getElementById('total-sent').textContent = totalSent;
                document.getElementById('response-rate').textContent = responseRate + '%';
                document.getElementById('best-subject').textContent = bestSubject;

                // Show recent emails with status update options
                const trackingDetails = document.getElementById('tracking-details');
                if (data.length > 0) {
                    trackingDetails.innerHTML = `
                        <div style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                            <h3 style="color: var(--brand-aqua); font-size: 1rem; margin-bottom: 15px;">Recent Emails (Click to Update Status)</h3>
                            <div style="display: grid; gap: 10px;">
                                ${data.slice(0, 10).map(email => `
                                    <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--brand-gold); font-size: 0.9rem;">${email.prospect_name} - ${email.prospect_company}</div>
                                            <div style="font-size: 0.8rem; opacity: 0.7; margin-top: 3px;">${email.sent_date} ‚Ä¢ ${email.subject_line.substring(0, 40)}...</div>
                                        </div>
                                        <div style="display: flex; gap: 5px;">
                                            <select id="status-${email.id}" onchange="updateEmailStatus('${email.id}')" style="padding: 6px; border-radius: 6px; background: var(--input-bg); color: var(--brand-teal); border: 1px solid rgba(255,255,255,0.1); font-size: 0.85rem;">
                                                <option value="sent" ${email.status === 'sent' ? 'selected' : ''}>üì§ Sent</option>
                                                <option value="opened" ${email.status === 'opened' ? 'selected' : ''}>üëÄ Opened</option>
                                                <option value="responded" ${email.status === 'responded' ? 'selected' : ''}>üí¨ Responded</option>
                                                <option value="booked" ${email.status === 'booked' ? 'selected' : ''}>‚úÖ Meeting Booked</option>
                                                <option value="no_response" ${email.status === 'no_response' ? 'selected' : ''}>‚ùå No Response</option>
                                            </select>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    trackingDetails.innerHTML = `
                        <div style="margin-top: 20px; padding: 15px; background: rgba(16, 195, 176, 0.1); border-radius: 8px; text-align: center;">
                            <p style="opacity: 0.8;">No emails tracked yet. Click "Mark as Sent" after generating emails to start tracking!</p>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Stats error:', error);
                document.getElementById('tracking-details').innerHTML = `
                    <div style="margin-top: 20px; padding: 15px; background: rgba(230, 69, 99, 0.1); border-radius: 8px; text-align: center;">
                        <p style="color: var(--brand-pink);">Email tracking not set up yet. Run the SQL schema to create the Email_Tracking table.</p>
                    </div>
                `;
            }
        }

        // Update email status
        async function updateEmailStatus(emailId) {
            const newStatus = document.getElementById(`status-${emailId}`).value;

            try {
                const { error } = await supabaseClient
                    .from('Email_Tracking')
                    .update({
                        status: newStatus,
                        response_date: newStatus === 'responded' || newStatus === 'booked' ? new Date().toISOString().split('T')[0] : null
                    })
                    .eq('id', emailId);

                if (error) throw error;

                showAlert(`‚úÖ Status updated to: ${newStatus}`, 'success');
                loadEmailStats(); // Refresh stats

            } catch (error) {
                console.error('Update error:', error);
                showAlert('‚ö†Ô∏è Failed to update status', 'error');
            }
        }
    </script>

</body>
</html>
